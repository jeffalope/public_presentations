USE [StaticDataAsCode]
GO

/***********************************************************************
	Cleanup in order to make the script re-runnable
***********************************************************************/
IF OBJECT_ID('dbo.Item') IS NOT NULL
BEGIN
	DROP TABLE dbo.Item;
END
GO

IF OBJECT_ID('dbo.DestinationItem') IS NOT NULL
BEGIN
	DROP TABLE dbo.DestinationItem;
END
GO

IF EXISTS (SELECT * FROM SSISDB.[catalog].projects where [name] = 'DataAsCode')
BEGIN
	EXEC [SSISDB].[catalog].[delete_project] 
		@project_name=N'DataAsCode', 
		@folder_name=N'DataAsCode'
END
GO


/***********************************************************************
	Create the Source and Destination Tables
***********************************************************************/
CREATE TABLE dbo.Item
(
	ItemID INT IDENTITY NOT NULL,
	ItemName VARCHAR(40) NOT NULL,
	CreateDateUTC DATETIME2(0) NOT NULL,
	PRIMARY KEY (ItemID)
);
GO

CREATE TABLE dbo.DestinationItem
(
	ItemID INT NOT NULL,
	ItemName VARCHAR(40) NOT NULL,
	CreateDateUTC DATETIME2(0) NOT NULL,
	LoadDateUTC DATETIME2(0) NOT NULL DEFAULT (GETUTCDATE())
	PRIMARY KEY (ItemID)
);
GO


/***********************************************************************
	Setup some basic test data
***********************************************************************/
INSERT INTO dbo.Item
(
	ItemName,
	CreateDateUTC
)
VALUES 
('avocado toast', GETUTCDATE()),
('avocado toast with egg', GETUTCDATE()),
('avocado toast with egg and bacon', GETUTCDATE());
GO

/***********************************************************************
	Cleanup destination and verify its empty before running the package
***********************************************************************/
TRUNCATE TABLE dbo.DestinationItem;
GO

SELECT * FROM dbo.DestinationItem;
GO

/***********************************************************************
	Depoy the package using TSQL Only.  The package just copies data from
	dbo.Item into dbo.DestinationItem.
***********************************************************************/
IF NOT EXISTS (SELECT 1 FROM SSISDB.catalog.folders where name = 'DataAsCode')
BEGIN
	EXEC [SSISDB].[catalog].[create_folder] 
		@folder_name=N'DataAsCode';
END
GO

EXEC [SSISDB].[catalog].[deploy_project] 
	@folder_name=N'DataAsCode',
	@project_name=N'DataAsCode',
	@project_stream=0x504B03041400000008007A724D5256A07FF3500D0000E15300000C001C005061636B6167652E6474737820A2180028A014000000000000000000000000000000000000000000ED1CDB92DBB6EEBD33FD07D64FEDD496EF1B7BE375C7B7CDF1CC269B133B3D0F691F68895EAB912597A4D6EB76F241E737CE971D8094255996BC76D6DE3A693593CC9A04011000419080D4FAE961EE907BC685EDB957B9B251CAFDD4FEF69B567F3CBA1C3C30D39774E2300240AEB884C6ABDC72B934E6B6C93DE14DA5617AF3E2E87767C438E028F6A5C87DFB0D21389AB3E9D0BACABDA5E6477AC7C2E61E675402AD3E95EC2A5729568B9552A54CCA95CB5AE9B256259DD75BA06FE81C405F873453517ABCE7CD17BE645C83DF0C5E0D6FDF2461E27DBFFCC6A6533784807FC3FE55EECF66B9D66F769A9542B7DBAF146A2F7AF542A352AB15CA9D8B8B8B4EB553EF954B9FC251918CC6ABC54E2E6FA890AF3DCB9EDACC7ACB3DCB37E5CFA1D8EB46C9A8944A25A35CAF44233C933A0C992A97AAD5B0F976F21B33A59E499248F05BF3528F9AB927610CD0BA61F7CC8977053C747DDB016D9593EDAFDE2BA15C742BB57EA5715168944ABD42AD5CBF28741BCD4EA15EAB35FACD17D7D55EB3FC29D7C6C1AD80E08271B9C2068D6F83DF6B8FCFE97AFAB976A3558C0F8AD0FC4CB98DB215A418354622176D8D3FD1AC1BD3ACF017B03A4AAE1D6F49C6547CCCC52133ADCD5E30C776D906709F0993DB0BA9B4B703E9DAA83AFD72B556AD0D0ABDEA45B950EBBF6882FC1AB5C28BE6A0571D0CAEBBDD72E7D3C6C81D8695C650642B85F24647DC5A76308A0D3DCF95D494202DC6A7A0214166F6DDACB0D0BFA86B32622106F6203955D69427F0972B5437FE26D4B588E351CB76EF5E861C939EC7171E57102F49D43CFAF70DD18EE325F9BEF703C918D0711CF20E189182BC6302E1AD9733291797C5E2B62F12BF3B45E12F60B42C5A6C4A7D471A542C5E9673EDF574532D2BECD0F2424985EDD0B308641E359198D3CCB5E3ED2DE063E1B9CC9562A33DDEB3D94EC84E33FDA5D3BF256F06630256276D57892597C410A2EE3954083484C8625E5317B05ABD35C8BF3C21531028ED0FDDA9071E127428B4B66D577AA057024C18C0440109393675A5EA9E50C1889C51497C01C2A4B146B571789CDCDB6C6910C41847485CB6C45EF660E3A4EE34BC41AE551B051A2C8F3863A4C9827BF7B6C538018323B7FD6E8F00262781D8D53D56242BE33053FCDF7F0FB144B28F29BEAC6C89DB8A7B90AF4BDC5B737595F7D9C78A71567D5B2C3C6163BFB8CA49EEB32DB070E95572ED645F6BA1B7119B25975FBC77B5DD45D4B4B4B71DAD846473632439C86A8BFC96FEC633169F56522B38FF6DA9E0C31E169C099C8BA6FBC693F674950AAA85384684B7FC675032FAF454C8F7434436B06C0878E26E00BDCA78C35FA3C9DB261306BA7EEE39C28008853AAFC16BDAE8EEF4FC35A65C3B674DBC9C918B4D740842CAB58A8BF8C6FD14790F5D59DD5E2A5BE21E2D980962828500B2F5E71330516F4AB8B7140468910995E6CC20A894600B20B62025B29CD9E64C2F1C1C29407E44D87F80CD0B321A0D4768D18CBBD421137F3A65DC20C7D15917F91901A15CBBF4FCC21A6F084930F0F3E06B260C8C00668EFBC61C776D69CF412E9E2F0DD221F7D4F11982974026966D42AC2EE0AFA9EDDA9229D082823C8E7C7A9A8531A005ACB976F59852EA7A9EC3E8B6A7D99293362AF01A60270CEC83A3B7F395BB65048E385DDF810869B1D25632A5100D01803D472FA981E28112C86E02030018F609499061B56284416E5D67454C68A5B61BFA584182AD0230D922A27124B7F15E30E47FA8B8F9CF8CB96F3D180EAE24D746077B4479EF7099212B3C8C4470A8F263EDC84DC13E01DB44CCCBECE02EEC4AF3F6106EB9AE3EF6A46E0551771AB7078764E844D7E43E0CFB93E8E7AFA9E288C8EBF88CAB9342BF31E8D53B83EB42F7BADF2FE0F1AAD0AD97FB8546AFD26CF6FA17A541A5F1E9124270E5A9F643FC2E980AF730B68DF119F48B0F0E1E1F66101682FE603226CEB6237A9EC5D279DF5839417819A34BE61AF10E33D810502E168547AADDA5BE96EDC2613F55ADAAE7381A1D2A221F52BA88EA4A170EE3DCE3EFBC652C90B9CA5D53DB09CD3E75D88C8A11B882016C3DA6CC8A7C22016632B51D124562E9798E3F4F5D0D499874889308D108B8FA80E1C4B09F2E547C4C6ACE98D50F5D8E5D7B04541F7B35DA4CD0F55A7ACD244577A6B939FA240701997D278BF11710DFC1C72B26093619B7BEDCA03EF27C0E7B906EDE166FCA623B1FFDA3CAF6B780A590E94E2602BE61EE9D9C5DE56AA5BD8D2533B2C6E72F3497DDB2398DC1689A676B32EAD68EE165F2FB716F7FBBB126186DC25E375FA487D049B3D8A0736EB6B1A7108E6F2009C21956D22A3EBAF7B4D22527D2A7620B0822611663DC21B30C331DE373DAE8A11EDFDA676373E35B5AF6B23CCFD9EF7660D67E6EDD79DCA1BB9BAEFC4B12D39E6BD94A73658FC863D3877D4942C1DBCC9388248638DB7B65F8A6B4B387F6742967998CE34ACBD38E360D97EE3ACE4126E9CFE3321FE07165EDDA33AE1B4CC757D940EEF98B759630F9D8426102449F757689B3913A54AC5C73C63DD7F3853293A39FE5D2D5AFD5F0C8C1290E74BC85B2B7D6C20D59B5661FDBF1D96B97793C5478367EB5C58480997002EFEFA873EDD03B81269AEDDFCE4C59F8E3CB52D76E8E371486A07BAAAC92ED811F5F835901642ACA35C2143F9DEE8FF12E2AB8BA39524A771D699F388FDBF35CE1E3C5BECAD84DB9378FA53AF3E4F66640FADDBC4AE1E5313D78CBA9A933812A473863808E7326801EE6F489CA0B5E73D0F0D2E31F35D6F515B641DE63FE90A814137050404A42C2EE3A075EF1B2DC62533054851670625E463099C84106C505A90C93A52D676AF82E3E54BA321A7406D9DFED85BB717FFA8F927856CE3873991C9A28AE9D47A2384A32A9ACD286EC614A1699AC0285064B1C351297F691F241A3DF9D20EBF6AC19E42F21FB9995FEA46E4A06F4ECB39AC390FF5856933AB80FB99E5B104A3DE1BD15C843EF9A00346198DC746CD39698AFF45C584B122C14BAF428108954C6AAF7CCF5D85D32E920E16180559B464F21D67580CF978ADCB291E082EBAB2EDC38836A8D3944F068419C0183EC9E252D0F97D87A8EBBECC884B98BD759C701095CF60283DD106458A96CF4A5080B29957CDF310ADB9236838E451730F2C701788EB117B753683D6E11C7D3D3E519CC9F63D23CBC5EFE2753FE8C99F2135C31ED9927D8E3066863C05F7B03F3B9E9D4279DDC55ADC02D1F73DF3595D7BB5D570AA973C17A6BDC39FCF0520335F4D05CD5BEF2399F44F75E39942C2019AA64B77C4F79CFF4F909DB27E658FE2666F94842FDF144D32973EE7B26B7BE26FB7D4AF22B3B8FFF3730E673A9003824017922C37DCA6DF199941B9C6AA73DD70283D3B9F02FBCA4E0C4EEE0403F7A4015C16149F38C6CCC090F288FE7BC3F239B9D82FBBC4F34E949BEA37891A7EF349FC7DC9EDEEBAF94ED7379AC53AAE0A008F5FCD4701AFF782A813F21C63A3FD13F5F85CAC9F83BC78A94274DF6592A504EC8E1DFA8E224D6BE39A4B5A072B685051B9324771A92F116D1EC7B9FCB5CEBE46F54EDBA2F4EC20A49F9AEBAC07DEFAD133A6C1593C285962079147D3DA298FAF908DD1C7DCD437FC7A498F6219356F06511FBCEC5DDE66D94A4697DF7A1D7EF8C3B1F5A199FEBF9AE5018E37BA30A0AD3DC4AA2AA14C87675B1814357606AF1041B66B8D57BAB5A58FA8DE9F558DB351DDFD2AFFD8603846FCEF06DE9EF1FF2AB1F00BDC72DD41E1379B2B42D39CBAB0F80CC1856C9188542C0D9704A8034663A7CEA382BC22C3B78CD754D0C47CDE947CCC8CF6D50E2479657434CEA128B394C32624B838418C711D740D87140F1F8FF041060DA76FD99021719478A135F67AA179CDDDB9E2FD284B10C30389E908A21A9DE1F476DA8A216E8A5BEF410DA5448392B50CEA97BA78B65804D2CE310047045434164FA3D5ECDBB360F75CF107EFCA7117C3707E635A0205F1773A4138646ABA8065A2451D24E7F01C2F200145855EF0B12EEBB589500036714E6C83541401B2C056D8D9AA982AA5F7037BE20B436D71B2519AC1E8B2CFB15A78B99EE8896408F82066CB9C2DA1AFD7DA8AB9CE97085564017BB4CCBBB0E5DC9EEF8660EBB1F081973D8CC31A01D5CB4FD872EBBA242B0F9C4595DED8B4D311B3F77B5DE00DA24F784E00BF9F8E5A59251CBD7CAC6C58633D9E39B41F88CBDC50D9BC209B1DAAC194D781AB56AA9562E97F39566C56856E1A95F5C94ABF546DCA5B48A3181866E2221F85631A0AF7F21692CF77B448D4966BF32AD06DF219B0B71E7B07D1853C30C3DC9817B07FE7A37E90D3221642EA8F213E68CCDA94854FA2DC18B3C142BA5D245F181CE9DFD4DAF523AC4F0D24B46430BAC572EF2B56622A2D94DFF45D3A81CC4C1635F700999A9354BF97AA39E606660DDA530738C58249242A36234F2F56A1526B5B98547C48D9E0FBA4E464ADAA62E555F32AC18615811E4E0B132E7CFB5655CBEF11DE7D356183270AD183488A26CD44AD1B3FDFA84228090DBA779C0851DB5AAD1DC40B11D49C66700CBED6E9EF205AA3860000261AB935DD011F9837AC65D5680ED06AB8E34C6F4E03B6B2219F17216932911F43E13DF844A44773B6D236E393714F6E52DD41A007A222EB702C85D48E2BD876E12EB7D21D8EB83A0344C92ACCF26876D1B91AB59137EBB5D30B46E5B6DF81BC0DAC6917AB162B5DBB0DF2AAAE66866899161C31A3D34644DE4B8F34C7368E738E55631081CDBBFFEDAD68787D4730242268E1BFF07504B03041400000008007A724D52E64FE8E6680100008402000021001C006C6F63616C686F73742E537461746963446174614173436F64652E636F6E6D677220A2180028A0140000000000000000000000000000000000000000008D91DB4A03311086EF05DF21E47A0F6D6DEDF6904A4D2A14B10A59BC4FD3B146B38966B3D622BEBBD9B6AC62112404C2FC33FFCC7C195FBC171ABD812B953504B79316BE989C9E8C59CE87D41A03D207E14618B1068742AE2987412378B3D9248592CE96F6C127D216297FD51C5CB04A992FF1E90942B5C9EDF229782C4401046B2B857EB4A54FB8175E4926BC9896D4AEA0490F77CE08FE60D98CF6A6B3ABF8F28AB1B8DBCD587CD96BB338A39DC180B2F3D6AC937D3655D481A8E7DCB799B2DB6431CB877C5B7A2892BA4B1286A35A81F1BB57B358847E2445E8FEC0A19BB4EA13215A695F3920062AEF848ED05DB5D44A5EC336B7CF60C8B2DF173DD93B6F0FCEBAD0CA0678528F34FE5EBCF6DDC50ED123A67BEDB0462372EF9459135C97236E2B278134F44673A3BC121AD1A06ABB26BF6986040F6B273CAC10075939E5B72477158CA62F2F61FC1D2BB483C5F99CC7DF95F1FFC0FFFD91238CD23D83F408C23E744460F205504B03041400000008007A724D52C09FDC0953000000580000000E001C0050726F6A6563742E706172616D7320A2180028A014000000000000000000000000000000000000000000B3B1AFC8CD51284B2D2ACECCCFB35532D43350B2B7E3E5B2090EF60CB60A482C4ACC4D2D014A2A0055E5155B81446D95CACBCBF57233938BF28BF3D34AF492F373F5830B7382538B80A6E883542829E8DB0100504B03041400000008007A724D52BD519E2EA20300005720000011001C004050726F6A6563742E6D616E696665737420A2180028A014000000000000000000000000000000000000000000ED59516FA240107EBFE4FE03E17D2D205068AB898236266DCF94B64FF7B285D5A307BB7659DA9AA6FFFD16C12228B562EF72AD26C6C49D9D6FD6D9EF9BDDEC9C38CEC0391A5272875C26CC7F30FEC327F80C3DA0A0253A883E20EA3042E11889C25318E0E82899DA121F1F1F1BA1EF521291116BB8243C70EE8374FE4132436C7FFF26082773DC09A2CC47D16CB0343C4D835FC010B5C4812DB69F0DB7E9F2CF08DC9ABA0E54D56D02A8991AB895254FF3949124EBE6CBC94101642D72F22DB66DC86027B2888736F5BF4134E299398777848A6DB9AEBB8F1377A9A67B37F603AFBEBB45C21061168973870D612C8A60420F9E459E4B4552642029406A5E49D2919A7C1A87AADA54753EAC1D491BAF72064F68BA5367BDD3C18F8B9F776834C23581F8DF9DC40C15003785B251E4527F92FCEBBA59BB82748C58AA8D6C233881B48DD3D32734842C4758E55F1C9B2B2EC384EE6FAEE39208D3C1C538D950C363D193981A7A98D1E990F898B54459140E0AB1166153508B609C16927388B98D16632E9917A307C485C12F12B186C338D9DC5CB1BCCAE0704C4BE12B62A5916C3409C834E1FC008F4839C349E5CBDD8790F205B07CB1798A32438162E78D37569AA176A73CCAD3547C05ACAC882B8C4B75B130732577D6A1CCF59B0A627BBC15E2D8066E80DD20F6D000DBE8361EDB7138A92C75EBA02ED17DEC53545D2BD7013808473EF31F506D841B18C4DC7B0483A8E2B0599B5E4EA8ABE9848334AB01562B7ED132A7EF87D19A6FB7C3A88FC77B62EF30B1135E080E89A98B5AAF9C391E600E0E03C1E2D6808C5B650EF1090C8D29BF40788283DC98FA6CDABAA2313AEE4C2681EFCEB65198054A4282DC133CDB46CFD23ABD3EE8F66D9BDF0B0D1B7435D90686A598A665EB524F315EAAE97BBCAD0A65E3BF92E175C425981E7ADEC0E3671C4FE55E913BACC8AF74D46475242B237B5AEF30ADCBDCF82A657C08A3E891506F4FEE4F4DEE8AA7A0CFC7C74BC4A08F1D3E33BFE7EFB9F9A9B9B9BF4FCCC99D3EBF95D9B3A7F48E51FA95215FA5685F477B56EF2EABFF121F7387354FE4851EC2C2137BC972CE6F16E97351BEF44297E163C8FB6CCAAA6D764C0574BBB602D4434B0386A2AA40EEE8BADE6976344B962A1A87EBF0533A678BAE5982DED3417C2FC89B7DC4778264DDC4ED5652EE296E23CE0CF2F47AB69B7A57516DC5D08121491650654D075DC3EC002D79F9330FFB4DCB946BEE66B68FA58EDA1B12FA87156A58ECC28B6DAD8EB2978E94286B9B15645F506749FC255167C34B1DB562AD68FF01504B03041400000008007A724D52503CD3FCAB0000005101000013001C005B436F6E74656E745F54797065735D2E786D6C20A2180028A01400000000000000000000000000000000000000000095904D0E82301046AFD2CC1E8A2E8C311417EA0DBC4053A640A43F690753CFE6C22379058B6C8D09CB99F9DEFB92793F5FF5319991DD31C4C159019BB2028656B976B09D808974B18763535F1F1E23CB511B05F444FEC079543D1A194BE7D1E68B76C148CA63E8B897EA263BE4DBAADA71E52CA1A582660734F519B59C46629794D74B6D4B31013B2DC1B94B0061229EB5C0F84F245B4D1756425E0669E24AC8483B688CF40FE3DF07351F504B01022D001400000008007A724D5256A07FF3500D0000E15300000C00000000000000000000000000000000005061636B6167652E64747378504B01022D001400000008007A724D52E64FE8E668010000840200002100000000000000000000000000960D00006C6F63616C686F73742E537461746963446174614173436F64652E636F6E6D6772504B01022D001400000008007A724D52C09FDC0953000000580000000E00000000000000000000000000590F000050726F6A6563742E706172616D73504B01022D001400000008007A724D52BD519E2EA2030000572000001100000000000000000000000000F40F00004050726F6A6563742E6D616E6966657374504B01022D001400000008007A724D52503CD3FCAB000000510100001300000000000000000000000000E11300005B436F6E74656E745F54797065735D2E786D6C504B0506000000000500050045010000D91400000000;


/***********************************************************************
	Run the package using TSQL
***********************************************************************/
DECLARE @execution_id BIGINT

EXEC [SSISDB].[catalog].[create_execution] 
	@package_name=N'Package.dtsx', 
	@execution_id=@execution_id OUTPUT, 
	@folder_name=N'DataAsCode', 
	@project_name=N'DataAsCode', 
	@use32bitruntime=False, 
	@reference_id=Null, 
	@runinscaleout=False

EXEC [SSISDB].[catalog].[start_execution] 
	@execution_id = @execution_id

GO

/***********************************************************************
	Verify the data was loaded
***********************************************************************/
SELECT * FROM dbo.DestinationItem;
GO

/***********************************************************************
	Demonstrate how to get the project stream for deployment
***********************************************************************/
EXEC [SSISDB].[catalog].[get_project] 
	@Folder_name = N'DataAsCode', 
	@Project_name = N'DataAsCode'
GO

/***********************************************************************
	Create a procedure that deploys the package
***********************************************************************/
CREATE OR ALTER PROCEDURE dbo.DeployPackage_DataAsCode
AS
BEGIN

	DECLARE @FolderName sysname = N'DataAsCode';
	DECLARE @ProjectName sysname = N'DataAsCode';
	DECLARE @ProjectStream VARBINARY(MAX) = 0x504B03041400000008007A724D5256A07FF3500D0000E15300000C001C005061636B6167652E6474737820A2180028A014000000000000000000000000000000000000000000ED1CDB92DBB6EEBD33FD07D64FEDD496EF1B7BE375C7B7CDF1CC269B133B3D0F691F68895EAB912597A4D6EB76F241E737CE971D8094255996BC76D6DE3A693593CC9A04011000419080D4FAE961EE907BC685EDB957B9B251CAFDD4FEF69B567F3CBA1C3C30D39774E2300240AEB884C6ABDC72B934E6B6C93DE14DA5617AF3E2E87767C438E028F6A5C87DFB0D21389AB3E9D0BACABDA5E6477AC7C2E61E675402AD3E95EC2A5729568B9552A54CCA95CB5AE9B256259DD75BA06FE81C405F873453517ABCE7CD17BE645C83DF0C5E0D6FDF2461E27DBFFCC6A6533784807FC3FE55EECF66B9D66F769A9542B7DBAF146A2F7AF542A352AB15CA9D8B8B8B4EB553EF954B9FC251918CC6ABC54E2E6FA890AF3DCB9EDACC7ACB3DCB37E5CFA1D8EB46C9A8944A25A35CAF44233C933A0C992A97AAD5B0F976F21B33A59E499248F05BF3528F9AB927610CD0BA61F7CC8977053C747DDB016D9593EDAFDE2BA15C742BB57EA5715168944ABD42AD5CBF28741BCD4EA15EAB35FACD17D7D55EB3FC29D7C6C1AD80E08271B9C2068D6F83DF6B8FCFE97AFAB976A3558C0F8AD0FC4CB98DB215A418354622176D8D3FD1AC1BD3ACF017B03A4AAE1D6F49C6547CCCC52133ADCD5E30C776D906709F0993DB0BA9B4B703E9DAA83AFD72B556AD0D0ABDEA45B950EBBF6882FC1AB5C28BE6A0571D0CAEBBDD72E7D3C6C81D8695C650642B85F24647DC5A76308A0D3DCF95D494202DC6A7A0214166F6DDACB0D0BFA86B32622106F6203955D69427F0972B5437FE26D4B588E351CB76EF5E861C939EC7171E57102F49D43CFAF70DD18EE325F9BEF703C918D0711CF20E189182BC6302E1AD9733291797C5E2B62F12BF3B45E12F60B42C5A6C4A7D471A542C5E9673EDF574532D2BECD0F2424985EDD0B308641E359198D3CCB5E3ED2DE063E1B9CC9562A33DDEB3D94EC84E33FDA5D3BF256F06630256276D57892597C410A2EE3954083484C8625E5317B05ABD35C8BF3C21531028ED0FDDA9071E127428B4B66D577AA057024C18C0440109393675A5EA9E50C1889C51497C01C2A4B146B571789CDCDB6C6910C41847485CB6C45EF660E3A4EE34BC41AE551B051A2C8F3863A4C9827BF7B6C538018323B7FD6E8F00262781D8D53D56242BE33053FCDF7F0FB144B28F29BEAC6C89DB8A7B90AF4BDC5B737595F7D9C78A71567D5B2C3C6163BFB8CA49EEB32DB070E95572ED645F6BA1B7119B25975FBC77B5DD45D4B4B4B71DAD846473632439C86A8BFC96FEC633169F56522B38FF6DA9E0C31E169C099C8BA6FBC693F674950AAA85384684B7FC675032FAF454C8F7434436B06C0878E26E00BDCA78C35FA3C9DB261306BA7EEE39C28008853AAFC16BDAE8EEF4FC35A65C3B674DBC9C918B4D740842CAB58A8BF8C6FD14790F5D59DD5E2A5BE21E2D980962828500B2F5E71330516F4AB8B7140468910995E6CC20A894600B20B62025B29CD9E64C2F1C1C29407E44D87F80CD0B321A0D4768D18CBBD421137F3A65DC20C7D15917F91901A15CBBF4FCC21A6F084930F0F3E06B260C8C00668EFBC61C776D69CF412E9E2F0DD221F7D4F11982974026966D42AC2EE0AFA9EDDA9229D082823C8E7C7A9A8531A005ACB976F59852EA7A9EC3E8B6A7D99293362AF01A60270CEC83A3B7F395BB65048E385DDF810869B1D25632A5100D01803D472FA981E28112C86E02030018F609499061B56284416E5D67454C68A5B61BFA584182AD0230D922A27124B7F15E30E47FA8B8F9CF8CB96F3D180EAE24D746077B4479EF7099212B3C8C4470A8F263EDC84DC13E01DB44CCCBECE02EEC4AF3F6106EB9AE3EF6A46E0551771AB7078764E844D7E43E0CFB93E8E7AFA9E288C8EBF88CAB9342BF31E8D53B83EB42F7BADF2FE0F1AAD0AD97FB8546AFD26CF6FA17A541A5F1E9124270E5A9F643FC2E980AF730B68DF119F48B0F0E1E1F66101682FE603226CEB6237A9EC5D279DF5839417819A34BE61AF10E33D810502E168547AADDA5BE96EDC2613F55ADAAE7381A1D2A221F52BA88EA4A170EE3DCE3EFBC652C90B9CA5D53DB09CD3E75D88C8A11B882016C3DA6CC8A7C22016632B51D124562E9798E3F4F5D0D499874889308D108B8FA80E1C4B09F2E547C4C6ACE98D50F5D8E5D7B04541F7B35DA4CD0F55A7ACD244577A6B939FA240701997D278BF11710DFC1C72B26093619B7BEDCA03EF27C0E7B906EDE166FCA623B1FFDA3CAF6B780A590E94E2602BE61EE9D9C5DE56AA5BD8D2533B2C6E72F3497DDB2398DC1689A676B32EAD68EE165F2FB716F7FBBB126186DC25E375FA487D049B3D8A0736EB6B1A7108E6F2009C21956D22A3EBAF7B4D22527D2A7620B0822611663DC21B30C331DE373DAE8A11EDFDA676373E35B5AF6B23CCFD9EF7660D67E6EDD79DCA1BB9BAEFC4B12D39E6BD94A73658FC863D3877D4942C1DBCC9388248638DB7B65F8A6B4B387F6742967998CE34ACBD38E360D97EE3ACE4126E9CFE3321FE07165EDDA33AE1B4CC757D940EEF98B759630F9D8426102449F757689B3913A54AC5C73C63DD7F3853293A39FE5D2D5AFD5F0C8C1290E74BC85B2B7D6C20D59B5661FDBF1D96B97793C5478367EB5C58480997002EFEFA873EDD03B81269AEDDFCE4C59F8E3CB52D76E8E371486A07BAAAC92ED811F5F835901642ACA35C2143F9DEE8FF12E2AB8BA39524A771D699F388FDBF35CE1E3C5BECAD84DB9378FA53AF3E4F66640FADDBC4AE1E5313D78CBA9A933812A473863808E7326801EE6F489CA0B5E73D0F0D2E31F35D6F515B641DE63FE90A814137050404A42C2EE3A075EF1B2DC62533054851670625E463099C84106C505A90C93A52D676AF82E3E54BA321A7406D9DFED85BB717FFA8F927856CE3873991C9A28AE9D47A2384A32A9ACD286EC614A1699AC0285064B1C351297F691F241A3DF9D20EBF6AC19E42F21FB9995FEA46E4A06F4ECB39AC390FF5856933AB80FB99E5B104A3DE1BD15C843EF9A00346198DC746CD39698AFF45C584B122C14BAF428108954C6AAF7CCF5D85D32E920E16180559B464F21D67580CF978ADCB291E082EBAB2EDC38836A8D3944F068419C0183EC9E252D0F97D87A8EBBECC884B98BD759C701095CF60283DD106458A96CF4A5080B29957CDF310ADB9236838E451730F2C701788EB117B753683D6E11C7D3D3E519CC9F63D23CBC5EFE2753FE8C99F2135C31ED9927D8E3066863C05F7B03F3B9E9D4279DDC55ADC02D1F73DF3595D7BB5D570AA973C17A6BDC39FCF0520335F4D05CD5BEF2399F44F75E39942C2019AA64B77C4F79CFF4F909DB27E658FE2666F94842FDF144D32973EE7B26B7BE26FB7D4AF22B3B8FFF3730E673A9003824017922C37DCA6DF199941B9C6AA73DD70283D3B9F02FBCA4E0C4EEE0403F7A4015C16149F38C6CCC090F288FE7BC3F239B9D82FBBC4F34E949BEA37891A7EF349FC7DC9EDEEBAF94ED7379AC53AAE0A008F5FCD4701AFF782A813F21C63A3FD13F5F85CAC9F83BC78A94274DF6592A504EC8E1DFA8E224D6BE39A4B5A072B685051B9324771A92F116D1EC7B9FCB5CEBE46F54EDBA2F4EC20A49F9AEBAC07DEFAD133A6C1593C285962079147D3DA298FAF908DD1C7DCD437FC7A498F6219356F06511FBCEC5DDE66D94A4697DF7A1D7EF8C3B1F5A199FEBF9AE5018E37BA30A0AD3DC4AA2AA14C87675B1814357606AF1041B66B8D57BAB5A58FA8DE9F558DB351DDFD2AFFD8603846FCEF06DE9EF1FF2AB1F00BDC72DD41E1379B2B42D39CBAB0F80CC1856C9188542C0D9704A8034663A7CEA382BC22C3B78CD754D0C47CDE947CCC8CF6D50E2479657434CEA128B394C32624B838418C711D740D87140F1F8FF041060DA76FD99021719478A135F67AA179CDDDB9E2FD284B10C30389E908A21A9DE1F476DA8A216E8A5BEF410DA5448392B50CEA97BA78B65804D2CE310047045434164FA3D5ECDBB360F75CF107EFCA7117C3707E635A0205F1773A4138646ABA8065A2451D24E7F01C2F200145855EF0B12EEBB589500036714E6C83541401B2C056D8D9AA982AA5F7037BE20B436D71B2519AC1E8B2CFB15A78B99EE8896408F82066CB9C2DA1AFD7DA8AB9CE97085564017BB4CCBBB0E5DC9EEF8660EBB1F081973D8CC31A01D5CB4FD872EBBA242B0F9C4595DED8B4D311B3F77B5DE00DA24F784E00BF9F8E5A59251CBD7CAC6C58633D9E39B41F88CBDC50D9BC209B1DAAC194D781AB56AA9562E97F39566C56856E1A95F5C94ABF546DCA5B48A3181866E2221F85631A0AF7F21692CF77B448D4966BF32AD06DF219B0B71E7B07D1853C30C3DC9817B07FE7A37E90D3221642EA8F213E68CCDA94854FA2DC18B3C142BA5D245F181CE9DFD4DAF523AC4F0D24B46430BAC572EF2B56622A2D94DFF45D3A81CC4C1635F700999A9354BF97AA39E606660DDA530738C58249242A36234F2F56A1526B5B98547C48D9E0FBA4E464ADAA62E555F32AC18615811E4E0B132E7CFB5655CBEF11DE7D356183270AD183488A26CD44AD1B3FDFA84228090DBA779C0851DB5AAD1DC40B11D49C66700CBED6E9EF205AA3860000261AB935DD011F9837AC65D5680ED06AB8E34C6F4E03B6B2219F17216932911F43E13DF844A44773B6D236E393714F6E52DD41A007A222EB702C85D48E2BD876E12EB7D21D8EB83A0344C92ACCF26876D1B91AB59137EBB5D30B46E5B6DF81BC0DAC6917AB162B5DBB0DF2AAAE66866899161C31A3D34644DE4B8F34C7368E738E55631081CDBBFFEDAD68787D4730242268E1BFF07504B03041400000008007A724D52E64FE8E6680100008402000021001C006C6F63616C686F73742E537461746963446174614173436F64652E636F6E6D677220A2180028A0140000000000000000000000000000000000000000008D91DB4A03311086EF05DF21E47A0F6D6DEDF6904A4D2A14B10A59BC4FD3B146B38966B3D622BEBBD9B6AC62112404C2FC33FFCC7C195FBC171ABD812B953504B79316BE989C9E8C59CE87D41A03D207E14618B1068742AE2987412378B3D9248592CE96F6C127D216297FD51C5CB04A992FF1E90942B5C9EDF229782C4401046B2B857EB4A54FB8175E4926BC9896D4AEA0490F77CE08FE60D98CF6A6B3ABF8F28AB1B8DBCD587CD96BB338A39DC180B2F3D6AC937D3655D481A8E7DCB799B2DB6431CB877C5B7A2892BA4B1286A35A81F1BB57B358847E2445E8FEC0A19BB4EA13215A695F3920062AEF848ED05DB5D44A5EC336B7CF60C8B2DF173DD93B6F0FCEBAD0CA0678528F34FE5EBCF6DDC50ED123A67BEDB0462372EF9459135C97236E2B278134F44673A3BC121AD1A06ABB26BF6986040F6B273CAC10075939E5B72477158CA62F2F61FC1D2BB483C5F99CC7DF95F1FFC0FFFD91238CD23D83F408C23E744460F205504B03041400000008007A724D52C09FDC0953000000580000000E001C0050726F6A6563742E706172616D7320A2180028A014000000000000000000000000000000000000000000B3B1AFC8CD51284B2D2ACECCCFB35532D43350B2B7E3E5B2090EF60CB60A482C4ACC4D2D014A2A0055E5155B81446D95CACBCBF57233938BF28BF3D34AF492F373F5830B7382538B80A6E883542829E8DB0100504B03041400000008007A724D52BD519E2EA20300005720000011001C004050726F6A6563742E6D616E696665737420A2180028A014000000000000000000000000000000000000000000ED59516FA240107EBFE4FE03E17D2D205068AB898236266DCF94B64FF7B285D5A307BB7659DA9AA6FFFD16C12228B562EF72AD26C6C49D9D6FD6D9EF9BDDEC9C38CEC0391A5272875C26CC7F30FEC327F80C3DA0A0253A883E20EA3042E11889C25318E0E82899DA121F1F1F1BA1EF521291116BB8243C70EE8374FE4132436C7FFF26082773DC09A2CC47D16CB0343C4D835FC010B5C4812DB69F0DB7E9F2CF08DC9ABA0E54D56D02A8991AB895254FF3949124EBE6CBC94101642D72F22DB66DC86027B2888736F5BF4134E299398777848A6DB9AEBB8F1377A9A67B37F603AFBEBB45C21061168973870D612C8A60420F9E459E4B4552642029406A5E49D2919A7C1A87AADA54753EAC1D491BAF72064F68BA5367BDD3C18F8B9F776834C23581F8DF9DC40C15003785B251E4527F92FCEBBA59BB82748C58AA8D6C233881B48DD3D32734842C4758E55F1C9B2B2EC384EE6FAEE39208D3C1C538D950C363D193981A7A98D1E990F898B54459140E0AB1166153508B609C16927388B98D16632E9917A307C485C12F12B186C338D9DC5CB1BCCAE0704C4BE12B62A5916C3409C834E1FC008F4839C349E5CBDD8790F205B07CB1798A32438162E78D37569AA176A73CCAD3547C05ACAC882B8C4B75B130732577D6A1CCF59B0A627BBC15E2D8066E80DD20F6D000DBE8361EDB7138A92C75EBA02ED17DEC53545D2BD7013808473EF31F506D841B18C4DC7B0483A8E2B0599B5E4EA8ABE9848334AB01562B7ED132A7EF87D19A6FB7C3A88FC77B62EF30B1135E080E89A98B5AAF9C391E600E0E03C1E2D6808C5B650EF1090C8D29BF40788283DC98FA6CDABAA2313AEE4C2681EFCEB65198054A4282DC133CDB46CFD23ABD3EE8F66D9BDF0B0D1B7435D90686A598A665EB524F315EAAE97BBCAD0A65E3BF92E175C425981E7ADEC0E3671C4FE55E913BACC8AF74D46475242B237B5AEF30ADCBDCF82A657C08A3E891506F4FEE4F4DEE8AA7A0CFC7C74BC4A08F1D3E33BFE7EFB9F9A9B9B9BF4FCCC99D3EBF95D9B3A7F48E51FA95215FA5685F477B56EF2EABFF121F7387354FE4851EC2C2137BC972CE6F16E97351BEF44297E163C8FB6CCAAA6D764C0574BBB602D4434B0386A2AA40EEE8BADE6976344B962A1A87EBF0533A678BAE5982DED3417C2FC89B7DC4778264DDC4ED5652EE296E23CE0CF2F47AB69B7A57516DC5D08121491650654D075DC3EC002D79F9330FFB4DCB946BEE66B68FA58EDA1B12FA87156A58ECC28B6DAD8EB2978E94286B9B15645F506749FC255167C34B1DB562AD68FF01504B03041400000008007A724D52503CD3FCAB0000005101000013001C005B436F6E74656E745F54797065735D2E786D6C20A2180028A01400000000000000000000000000000000000000000095904D0E82301046AFD2CC1E8A2E8C311417EA0DBC4053A640A43F690753CFE6C22379058B6C8D09CB99F9DEFB92793F5FF5319991DD31C4C159019BB2028656B976B09D808974B18763535F1F1E23CB511B05F444FEC079543D1A194BE7D1E68B76C148CA63E8B897EA263BE4DBAADA71E52CA1A582660734F519B59C46629794D74B6D4B31013B2DC1B94B0061229EB5C0F84F245B4D1756425E0669E24AC8483B688CF40FE3DF07351F504B01022D001400000008007A724D5256A07FF3500D0000E15300000C00000000000000000000000000000000005061636B6167652E64747378504B01022D001400000008007A724D52E64FE8E668010000840200002100000000000000000000000000960D00006C6F63616C686F73742E537461746963446174614173436F64652E636F6E6D6772504B01022D001400000008007A724D52C09FDC0953000000580000000E00000000000000000000000000590F000050726F6A6563742E706172616D73504B01022D001400000008007A724D52BD519E2EA2030000572000001100000000000000000000000000F40F00004050726F6A6563742E6D616E6966657374504B01022D001400000008007A724D52503CD3FCAB000000510100001300000000000000000000000000E11300005B436F6E74656E745F54797065735D2E786D6C504B0506000000000500050045010000D91400000000;
	
	IF NOT EXISTS (SELECT 1 FROM SSISDB.catalog.folders where name = @FolderName)
	BEGIN
		EXEC [SSISDB].[catalog].[create_folder] 
			@folder_name=@FolderName;
	END

	EXEC [SSISDB].[catalog].[deploy_project] 
		@folder_name=@FolderName,
		@project_name=@ProjectName,
		@project_stream=@ProjectStream;
	
END
GO

/***********************************************************************
	Cleanup the project so we can verify it deploys correctly
***********************************************************************/
IF EXISTS (SELECT * FROM SSISDB.[catalog].projects where [name] = 'DataAsCode')
BEGIN
	EXEC [SSISDB].[catalog].[delete_project] 
		@project_name=N'DataAsCode', 
		@folder_name=N'DataAsCode';
END
GO

EXEC dbo.DeployPackage_DataAsCode;

/***********************************************************************
	Cleanup destination and verify its empty before running the package
***********************************************************************/
TRUNCATE TABLE dbo.DestinationItem;
GO

SELECT * FROM dbo.DestinationItem;
GO

/***********************************************************************
	Run the package using TSQL
***********************************************************************/
DECLARE @execution_id BIGINT

EXEC [SSISDB].[catalog].[create_execution] 
	@package_name=N'Package.dtsx', 
	@execution_id=@execution_id OUTPUT, 
	@folder_name=N'DataAsCode', 
	@project_name=N'DataAsCode', 
	@use32bitruntime=False, 
	@reference_id=Null, 
	@runinscaleout=False

EXEC [SSISDB].[catalog].[start_execution] 
	@execution_id = @execution_id

GO

/***********************************************************************
	Verify the data was loaded
***********************************************************************/
SELECT * FROM dbo.DestinationItem;
GO
/***********************************************************************
	Some additional considerations

	1) Add logic to deployment processes to recognize that static data
		related to packages was modified and might need to be refreshed.  

	2) Create a single procedure that executes all of your SSIS packages 
		so that you can ensure none of them are missed.  It could be 
		hardcoded or if you used fixed format you could just loop
		over all the procedures with a given name format.
***********************************************************************/